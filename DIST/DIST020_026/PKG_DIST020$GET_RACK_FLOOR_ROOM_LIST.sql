CREATE DEFINER=`root`@`%` PROCEDURE `swmcp`.`PKG_DIST020$GET_RACK_FLOOR_ROOM_LIST`(
			IN A_RACK_DIV 		bigint(20),
            OUT N_RETURN      	INT,
            OUT V_RETURN      	VARCHAR(4000)
)
PROC:begin
	
	declare exit HANDLER for sqlexception
	call USP_SYS_GET_ERRORINFO_ALL(V_RETURN, N_RETURN); 

	SELECT 
	      A.RACK_DIV,
	      A.RACK_CODE,
	      LPAD(A.FLOOR, 3, '0') as FLOOR,
	      MAX(CASE WHEN ROOM_ORDER = 1 THEN IFNULL(A.STOCK_QTY, 0) END) AS R01,
	      MAX(CASE WHEN ROOM_ORDER = 2 THEN IFNULL(A.STOCK_QTY, 0) END) AS R02,
	      MAX(CASE WHEN ROOM_ORDER = 3 THEN IFNULL(A.STOCK_QTY, 0) END) AS R03,
	      MAX(CASE WHEN ROOM_ORDER = 4 THEN IFNULL(A.STOCK_QTY, 0) END) AS R04,
	      MAX(CASE WHEN ROOM_ORDER = 5 THEN IFNULL(A.STOCK_QTY, 0) END) AS R05,
	      MAX(CASE WHEN ROOM_ORDER = 6 THEN IFNULL(A.STOCK_QTY, 0) END) AS R06,
	      MAX(CASE WHEN ROOM_ORDER = 7 THEN IFNULL(A.STOCK_QTY, 0) END) AS R07,
	      MAX(CASE WHEN ROOM_ORDER = 8 THEN IFNULL(A.STOCK_QTY, 0) END) AS R08,
	      MAX(CASE WHEN ROOM_ORDER = 9 THEN IFNULL(A.STOCK_QTY, 0) END) AS R09,
	      MAX(CASE WHEN ROOM_ORDER = 10 THEN IFNULL(A.STOCK_QTY, 0) END) AS R10
	FROM (
	      SELECT 
	            DISTINCT AA.RACK_DIV,
	            AA.RACK_CODE,
	            BB.FLOOR,
	            AA.ROOM,
	            SUM(STT.STOCK_QTY) as STOCK_QTY,
	            ROW_NUMBER() OVER (PARTITION BY AA.RACK_DIV, BB.FLOOR 
	                               ORDER BY AA.ROOM) AS ROOM_ORDER
	      FROM TB_RACK AA
	      LEFT JOIN (
	                   SELECT DISTINCT RACK_DIV, FLOOR FROM TB_RACK
	              ) BB ON AA.FLOOR = BB.FLOOR AND AA.RACK_DIV = BB.RACK_DIV
	      LEFT JOIN TB_STOCK STT
	            ON STT.WARE_POS = AA.RACK_CODE
	        GROUP BY AA.RACK_DIV, BB.FLOOR, AA.ROOM
	    ) AS A
	LEFT JOIN TB_STOCK ST
	    ON ST.WARE_POS = A.RACK_CODE
	WHERE CASE 
			  WHEN A_RACK_DIV != 0
			  THEN FIND_IN_SET(A.RACK_DIV, A_RACK_DIV)
			  ELSE A.RACK_DIV LIKE '%'
		  END 
	GROUP BY A.RACK_DIV, A.FLOOR

	;

	set N_RETURN := 0;
    set V_RETURN := '조회 되었습니다';
END